import{a as ie,b as ne,c as re,d as oe,e as ae,f as se,g as le,h as de,i as ce,j as me,k as pe}from"./chunk-VVZ6GDKP.js";import{a as ge}from"./chunk-W4XRG47B.js";import{a as xe}from"./chunk-HS72ZNLO.js";import{a as ue}from"./chunk-664333HR.js";import{$ as q,B as N,C as H,I as y,J as I,K as P,L as X,M as v,N as _,O as W,P as i,Q as n,R as k,S as L,T as M,U as m,V as G,X as Y,Y as r,Z as C,_ as p,ba as V,ca as $,da as U,ea as O,ga as Z,ia as J,ja as K,n as x,o as f,p as T,q as B,qa as Q,ra as ee,x as a,ya as te}from"./chunk-IIWWASKY.js";var Se=()=>[0,1,2,3,4],Te=(o,t)=>t.status,fe=(o,t)=>t.label,he=(o,t)=>t.assetID,Me=(o,t)=>t.ticketID;function De(o,t){if(o&1&&(T(),k(0,"line",30),i(1,"text",31),r(2),n()),o&2){let e=t.$implicit,s=m();y("y1",220-e*50)("y2",220-e*50),a(),y("y",220-e*50+4),a(),p(" ",s.roundNumber(s.getMaxStatusCount()/4*e)," ")}}function Ee(o,t){if(o&1&&(T(),k(0,"rect",32),i(1,"text",33),r(2),n(),i(3,"text",34),r(4),n()),o&2){let e=t.$implicit,s=t.$index,l=m();y("x",70+s*80)("y",l.getBarY(e.count,l.getMaxStatusCount(),220))("height",l.getBarHeight(e.count,l.getMaxStatusCount(),220))("fill",e.color),a(),y("x",70+s*80+20)("y",l.getBarY(e.count,l.getMaxStatusCount(),220)-8),a(),p(" ",e.count," "),a(),y("x",70+s*80+20),a(),p(" ",e.status," ")}}function Ie(o,t){if(o&1&&(T(),k(0,"path",35),i(1,"text",36),r(2),n()),o&2){let e=t.$implicit;y("d",e.path)("fill",e.color),a(),y("x",e.labelX)("y",e.labelY),a(),p(" ",e.count," ")}}function Pe(o,t){if(o&1&&(i(0,"div",13),k(1,"div",37),i(2,"span",38),r(3),n(),i(4,"span",39),r(5),n()()),o&2){let e=t.$implicit;a(),G("background-color",e.color),a(2),C(e.label),a(2),p("(",e.percentage,"%)")}}function Ve(o,t){if(o&1&&(i(0,"p",43),r(1),n()),o&2){let e=m().$implicit;a(),C(e.description)}}function $e(o,t){if(o&1&&(i(0,"div",16)(1,"div",40)(2,"div")(3,"span",41),r(4),n(),i(5,"h4",42),r(6),n(),I(7,Ve,2,1,"p",43),n()()()),o&2){let e=t.$implicit;a(4),p(" ",e.assetType," "),a(2),C(e.assetName),a(),P(e.description?7:-1)}}function Ue(o,t){o&1&&(i(0,"p",17),r(1,"No assets found"),n())}function Ae(o,t){if(o&1&&(i(0,"div",47),r(1),n()),o&2){let e=m().$implicit;a(),C(e.description)}}function Ne(o,t){if(o&1){let e=L();i(0,"tr",44),M("click",function(){let l=x(e).$implicit,d=m();return f(d.viewTicketDetail(l.ticketID))}),i(1,"td",45)(2,"div",46),r(3),n(),I(4,Ae,2,1,"div",47),n(),i(5,"td",48)(6,"div",49),r(7),n(),i(8,"div",47),r(9),n()(),i(10,"td",48)(11,"span"),r(12),n()(),i(13,"td",48)(14,"span"),r(15),n()(),i(16,"td",50),r(17),J(18,"date"),n()()}if(o&2){let e=t.$implicit,s=m();a(3),C(e.title),a(),P(e.description?4:-1),a(3),C(e.assetName),a(2),C(e.assetType),a(2),Y(O("px-2 inline-flex text-xs leading-5 font-semibold rounded-full ",s.getPriorityColor(e.priority))),a(),p(" ",e.priority," "),a(2),Y(O("px-2 inline-flex text-xs leading-5 font-semibold rounded-full ",s.getStatusColor(e.status))),a(),p(" ",e.status," "),a(2),p(" ",K(18,13,e.createdDate,"short")," ")}}function Fe(o,t){o&1&&(i(0,"tr")(1,"td",51),r(2,"No tickets found"),n()())}function Be(o,t){if(o&1&&(i(0,"div",58),r(1),n()),o&2){let e=m(2);a(),p(" ",e.errorMessage," ")}}function We(o,t){if(o&1&&(i(0,"option",63),r(1),n()),o&2){let e=t.$implicit;W("value",e.assetID),a(),q("",e.assetName," (",e.assetType,")")}}function Le(o,t){if(o&1){let e=L();i(0,"div",29)(1,"div",52)(2,"div",53),M("click",function(){x(e);let l=m();return f(l.closeCreateTicketModal())}),n(),i(3,"span",54),r(4,"\u200B"),n(),i(5,"div",55)(6,"div",56)(7,"h3",57),r(8,"Create New Ticket"),n(),I(9,Be,2,1,"div",58),i(10,"form",59),M("ngSubmit",function(){x(e);let l=m();return f(l.createTicket())}),i(11,"div",60)(12,"div")(13,"label",61),r(14,"Asset"),n(),i(15,"select",62),U("ngModelChange",function(l){x(e);let d=m();return $(d.newTicket.assetID,l)||(d.newTicket.assetID=l),f(l)}),v(16,We,2,3,"option",63,he),n()(),i(18,"div")(19,"label",64),r(20,"Title"),n(),i(21,"input",65),U("ngModelChange",function(l){x(e);let d=m();return $(d.newTicket.title,l)||(d.newTicket.title=l),f(l)}),n()(),i(22,"div")(23,"label",66),r(24,"Description"),n(),i(25,"textarea",67),U("ngModelChange",function(l){x(e);let d=m();return $(d.newTicket.description,l)||(d.newTicket.description=l),f(l)}),n()(),i(26,"div")(27,"label",68),r(28,"Priority"),n(),i(29,"select",69),U("ngModelChange",function(l){x(e);let d=m();return $(d.newTicket.priority,l)||(d.newTicket.priority=l),f(l)}),i(30,"option",70),r(31,"Low"),n(),i(32,"option",71),r(33,"Medium"),n(),i(34,"option",72),r(35,"High"),n()()()(),i(36,"div",73)(37,"button",74),r(38),n(),i(39,"button",75),M("click",function(){x(e);let l=m();return f(l.closeCreateTicketModal())}),r(40," Cancel "),n()()()()()()()}if(o&2){let e=m();a(9),P(e.errorMessage?9:-1),a(6),V("ngModel",e.newTicket.assetID),a(),_(e.assets),a(5),V("ngModel",e.newTicket.title),a(4),V("ngModel",e.newTicket.description),a(4),V("ngModel",e.newTicket.priority),a(8),W("disabled",e.loading),a(),p(" ",e.loading?"Creating...":"Create Ticket"," ")}}var be=class o{constructor(t,e,s){this.assetService=t;this.ticketService=e;this.router=s}assets=[];tickets=[];pieChartData=[];showCreateTicketModal=!1;newTicket={assetID:"",title:"",description:"",priority:"Medium"};loading=!1;errorMessage="";ngOnInit(){this.loadAssets(),this.loadTickets(),this.pieChartData=this.getPieChartData()}loadAssets(){this.assetService.getAssets().subscribe({next:t=>{this.assets=t},error:t=>{console.error("Error loading assets:",t)}})}loadTickets(){this.ticketService.getTickets().subscribe({next:t=>{this.tickets=t,this.refreshPieChart()},error:t=>{console.error("Error loading tickets:",t),this.refreshPieChart()}})}refreshPieChart(){this.pieChartData=this.getPieChartData(),console.log("Pie chart refreshed:",this.pieChartData)}openCreateTicketModal(){console.log("Opening create ticket modal..."),this.showCreateTicketModal=!0,this.newTicket={assetID:this.assets[0]?.assetID||"",title:"",description:"",priority:"Medium"},this.errorMessage=""}closeCreateTicketModal(){this.showCreateTicketModal=!1,this.errorMessage=""}createTicket(){if(!this.newTicket.title||!this.newTicket.assetID){this.errorMessage="Please fill in all required fields";return}this.loading=!0,this.ticketService.createTicket(this.newTicket).subscribe({next:()=>{this.loading=!1,this.closeCreateTicketModal(),this.loadTickets()},error:t=>{this.loading=!1,this.errorMessage=t.error?.message||"Error creating ticket"}})}getStatusColor(t){switch(t){case"Open":return"bg-blue-100 text-blue-800";case"In Progress":return"bg-yellow-100 text-yellow-800";case"Resolved":return"bg-green-100 text-green-800";case"Closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}getPriorityColor(t){switch(t){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}viewTicketDetail(t){this.router.navigate(["/tickets/detail",t])}getTicketStatusData(){let t=this.tickets.filter(d=>d.status==="Open").length,e=this.tickets.filter(d=>d.status==="In Progress").length,s=this.tickets.filter(d=>d.status==="Resolved").length,l=this.tickets.filter(d=>d.status==="Closed").length;return[{status:"Open",count:t,color:"#3b82f6"},{status:"In Progress",count:e,color:"#f59e0b"},{status:"Resolved",count:s,color:"#22c55e"},{status:"Closed",count:l,color:"#6b7280"}]}getMaxStatusCount(){let e=this.getTicketStatusData().map(s=>s.count);return Math.max(...e,5)}getBarHeight(t,e,s){return e===0?0:t/e*(s-20)}getBarY(t,e,s){return s-this.getBarHeight(t,e,s)}getPieChartData(){let t=["High","Medium","Low"],e=["#ef4444","#f59e0b","#22c55e"],s=t.map(c=>{let u=this.tickets.filter(w=>w.priority===c).length;return{priority:c,count:u}}),l=s.reduce((c,u)=>c+u.count,0);if(console.log("Pie Chart Debug - Tickets:",this.tickets),console.log("Pie Chart Debug - Data:",s),console.log("Pie Chart Debug - Total:",l),l===0)return t.map((c,u)=>({label:c,count:0,percentage:0,color:e[u],path:"",labelX:100,labelY:100}));if(l===1){let c=s.find(u=>u.count>0);if(c){let u=t.indexOf(c.priority),w=100,h=100,g=80;return t.map((S,A)=>{if(S===c.priority){let F=`M ${w} ${h} m -${g} 0 a ${g} ${g} 0 1 1 ${g*2} 0 a ${g} ${g} 0 1 1 -${g*2} 0`;return{label:S,count:1,percentage:100,color:e[u],path:F,labelX:w,labelY:h}}else return{label:S,count:0,percentage:0,color:e[A],path:"",labelX:w,labelY:h}})}}let d=0,D=100,E=100,b=80;return s.map((c,u)=>{let w=Math.round(c.count/l*100),h=c.count/l*360,g="",S=D,A=E;if(c.count>0){let F=d,ye=d+h,R=F*Math.PI/180,j=ye*Math.PI/180,ve=D+b*Math.cos(R),_e=E+b*Math.sin(R),Ce=D+b*Math.cos(j),we=E+b*Math.sin(j),ke=h>180?1:0;g=`M ${D} ${E} L ${ve} ${_e} A ${b} ${b} 0 ${ke} 1 ${Ce} ${we} Z`;let z=(d+h/2)*Math.PI/180;S=D+b*.7*Math.cos(z),A=E+b*.7*Math.sin(z),d+=h}return{label:c.priority,count:c.count,percentage:w,color:e[u],path:g,labelX:S,labelY:A}})}roundNumber(t){return Math.round(t)}static \u0275fac=function(e){return new(e||o)(N(ge),N(xe),N(te))};static \u0275cmp=H({type:o,selectors:[["app-user-dashboard"]],decls:61,vars:4,consts:[[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-8"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8",2,"position","relative","z-index","1"],[1,"bg-white","rounded-lg","shadow-md","p-6","border","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"relative","h-64"],["viewBox","0 0 420 240",1,"w-full","h-full",2,"pointer-events","none"],["x1","50","y1","220","x2","420","y2","220","stroke","#6b7280","stroke-width","1"],[1,"relative","h-64","flex","items-center","justify-center"],["viewBox","0 0 200 200",1,"w-48","h-48",2,"pointer-events","none"],[1,"mt-4","grid","grid-cols-2","gap-2"],[1,"flex","items-center"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"bg-white","rounded-lg","shadow-md","p-6","hover:shadow-lg","transition-shadow"],[1,"text-gray-500","col-span-full"],[2,"position","relative","z-index","10"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-900"],[1,"px-3","py-1.5","bg-primary","text-white","rounded-md","hover:bg-opacity-90","transition-colors","font-medium","text-sm","relative","z-10",2,"pointer-events","auto",3,"click"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden","border","border-gray-200"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","cursor-pointer"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","z-10","inset-0","overflow-y-auto"],["x1","50","x2","420","stroke","#e5e7eb","stroke-width","1"],["x","45","text-anchor","end","font-size","11","fill","#374151","font-family","system-ui, sans-serif"],["width","40","rx","3","ry","3"],["text-anchor","middle","font-size","11","fill","#374151","font-family","system-ui, sans-serif","font-weight","500"],["y","235","text-anchor","middle","font-size","11","fill","#374151","font-family","system-ui, sans-serif"],["stroke","#ffffff","stroke-width","2"],["text-anchor","middle","font-size","10","fill","#ffffff","font-family","system-ui, sans-serif","font-weight","600"],[1,"w-3","h-3","rounded-full","mr-2"],[1,"text-xs","text-gray-600","font-medium"],[1,"text-xs","text-gray-500","ml-1"],[1,"flex","items-start","justify-between"],[1,"inline-block","px-3","py-1","text-xs","font-semibold","text-primary","bg-blue-100","rounded-full","mb-2"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-2"],[1,"hover:bg-gray-50","cursor-pointer",3,"click"],[1,"px-6","py-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],["colspan","5",1,"px-6","py-4","text-center","text-gray-500"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],[1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"inline-block","align-bottom","bg-white","rounded-lg","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full"],[1,"bg-white","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"text-lg","leading-6","font-medium","text-gray-900","mb-4"],[1,"mb-4","bg-red-50","border","border-red-200","text-red-600","px-4","py-3","rounded"],[3,"ngSubmit"],[1,"space-y-4"],["for","asset",1,"block","text-sm","font-medium","text-gray-700"],["id","asset","name","assetID","required","",1,"mt-1","block","w-full","pl-3","pr-8","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],[3,"value"],["for","title",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","title","name","title","required","","placeholder","Enter ticket title",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm",3,"ngModelChange","ngModel"],["for","description",1,"block","text-sm","font-medium","text-gray-700"],["id","description","name","description","rows","3","placeholder","Enter ticket description",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm",3,"ngModelChange","ngModel"],["for","priority",1,"block","text-sm","font-medium","text-gray-700"],["id","priority","name","priority",1,"mt-1","block","w-full","pl-3","pr-8","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],["value","Low"],["value","Medium"],["value","High"],[1,"mt-5","sm:mt-6","sm:grid","sm:grid-cols-2","sm:gap-3","sm:grid-flow-row-dense"],["type","submit",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-primary","text-base","font-medium","text-white","hover:bg-opacity-90","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","sm:col-start-2","sm:text-sm","disabled:opacity-50",3,"disabled"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","sm:mt-0","sm:col-start-1","sm:text-sm",3,"click"]],template:function(e,s){e&1&&(k(0,"app-navbar"),i(1,"div",0)(2,"div",1)(3,"h2",2),r(4,"My Dashboard"),n(),i(5,"p",3),r(6,"Manage your assets and service requests"),n()(),i(7,"div",4)(8,"div",5)(9,"h3",6),r(10,"Summary Chart"),n(),i(11,"div",7),T(),i(12,"svg",8),v(13,De,3,4,null,null,X),v(15,Ee,5,9,null,null,Te),k(17,"line",9),n()()(),B(),i(18,"div",5)(19,"h3",6),r(20,"Priority Distribution"),n(),i(21,"div",10),T(),i(22,"svg",11),v(23,Ie,3,5,null,null,fe),n()(),B(),i(25,"div",12),v(26,Pe,6,4,"div",13,fe),n()()(),i(28,"div",1)(29,"h3",14),r(30,"My Assets"),n(),i(31,"div",15),v(32,$e,8,3,"div",16,he,!1,Ue,2,0,"p",17),n()(),i(35,"div",18)(36,"div",19)(37,"h3",20),r(38,"My Tickets"),n(),i(39,"button",21),M("click",function(){return s.openCreateTicketModal()}),r(40," Create New Ticket "),n()(),i(41,"div",22)(42,"div",23)(43,"table",24)(44,"thead",25)(45,"tr")(46,"th",26),r(47,"Title"),n(),i(48,"th",26),r(49,"Asset"),n(),i(50,"th",26),r(51,"Priority"),n(),i(52,"th",26),r(53,"Status"),n(),i(54,"th",26),r(55,"Created"),n()()(),i(56,"tbody",27),v(57,Ne,19,16,"tr",28,Me,!1,Fe,3,0,"tr"),n()()()()()(),I(60,Le,41,7,"div",29)),e&2&&(a(13),_(Z(3,Se)),a(2),_(s.getTicketStatusData()),a(8),_(s.pieChartData),a(3),_(s.pieChartData),a(6),_(s.assets),a(25),_(s.tickets),a(3),P(s.showCreateTicketModal?60:-1))},dependencies:[ee,pe,se,de,ce,ie,le,ne,re,me,ae,oe,ue,Q],encapsulation:2})};export{be as UserDashboardComponent};
